SET SCHEMA FN24_5MI0700203;

DROP TABLE TEAMS;
DROP TABLE EPISODES;
DROP TABLE DANCES;
DROP TABLE JURY;
DROP TABLE PERFORMANCES;
DROP TABLE JURY_SCORE;
DROP TABLE USERS;

CREATE TABLE DANCES
(
    NAME  VARCHAR(200) NOT NULL UNIQUE
        CONSTRAINT PK_DANCES_NAME PRIMARY KEY,
    DESCR VARCHAR(500),
    PHOTO VARCHAR(500)
);

CREATE TABLE EPISODES
(
    DATE     DATE    NOT NULL UNIQUE
        CONSTRAINT PK_EPISODES_DATE PRIMARY KEY,
    THEME    VARCHAR(100),
    WT_SMS   CHAR(5) NOT NULL,
    SWT_SMS  CHAR(5),
    THWT_SMS CHAR(5),
    LT_SMS   CHAR(5),
    SLT_SMS  CHAR(5)
);

CREATE TABLE JURY
(
    ID   INT NOT NULL UNIQUE
        CONSTRAINT PK_JURY_ID PRIMARY KEY
        GENERATED ALWAYS AS IDENTITY
            (START WITH 1 INCREMENT BY 1),
    NAME VARCHAR(100), 
    PROF VARCHAR(100), 
    PHOTO VARCHAR(500)
);

CREATE TABLE TEAMS
(
    SMS       CHAR(5) NOT NULL UNIQUE
        CONSTRAINT PK_TEAMS_SMS PRIMARY KEY,
    PART_NAME VARCHAR(100),
    PART_PROF VARCHAR(100),
    PROF_NAME VARCHAR(100),
    FINAL_POS INT,
    PHOTO VARCHAR(500)
);

CREATE TABLE PERFORMANCES
(
    ID         INT NOT NULL UNIQUE
        CONSTRAINT PK_PERFORMANCES_ID PRIMARY KEY
        GENERATED ALWAYS AS IDENTITY
            (START WITH 1 INCREMENT BY 1),
    SCORE_AUD  INT,
    TEAM_SMS   CHAR(5),
    DANCE_NAME VARCHAR(50),
    EP_DATE    DATE,
    NOTES      VARCHAR(500)
);

CREATE TABLE JURY_SCORE
(
    PERFORMANCE_ID INT NOT NULL,
    JURY_ID        INT NOT NULL,
    SCORE          INT NOT NULL
);

CREATE TABLE USERS
(
    EMAIL    VARCHAR(50) NOT NULL UNIQUE
        CONSTRAINT PK_USERS_EMAIL PRIMARY KEY,
    PASSWORD VARCHAR(1000),
    FAV_TEAM CHAR(5)
);


ALTER TABLE EPISODES
    ADD CONSTRAINT FK_EPISODES_TEAMS_LT_SMS FOREIGN KEY (LT_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE EPISODES
    ADD CONSTRAINT FK_EPISODES_TEAMS_SLT_SMS FOREIGN KEY (SLT_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE EPISODES
    ADD CONSTRAINT FK_EPISODES_TEAMS_WT_SMS FOREIGN KEY (WT_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE EPISODES
    ADD CONSTRAINT FK_EPISODES_TEAMS_SWT_SMS FOREIGN KEY (SWT_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE EPISODES
    ADD CONSTRAINT FK_EPISODES_TEAMS_THWT_SMS FOREIGN KEY (THWT_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE PERFORMANCES
    ADD CONSTRAINT FK_PERFORMANCES_TEAMS FOREIGN KEY (TEAM_SMS) REFERENCES TEAMS (SMS);

ALTER TABLE PERFORMANCES
    ADD CONSTRAINT FK_PERFORMANCES_DANCES FOREIGN KEY (DANCE_NAME) REFERENCES DANCES (NAME);

ALTER TABLE PERFORMANCES
    ADD CONSTRAINT FK_PERFORMANCES_EPISODES FOREIGN KEY (EP_DATE) REFERENCES EPISODES (DATE);

ALTER TABLE USERS
    ADD CONSTRAINT FK_USERS_TEAMS FOREIGN KEY (FAV_TEAM) REFERENCES TEAMS (SMS);

ALTER TABLE PERFORMANCES
    ADD CONSTRAINT CK_PERFORMANCES_SCORE CHECK (SCORE_AUD > 0 AND SCORE_AUD < 11);

ALTER TABLE JURY_SCORE
    ADD CONSTRAINT FK_PERFORMANCE_ID FOREIGN KEY (PERFORMANCE_ID) REFERENCES PERFORMANCES (ID);

ALTER TABLE JURY_SCORE
    ADD CONSTRAINT FK_JURY_ID FOREIGN KEY (JURY_ID) REFERENCES JURY (ID);

ALTER TABLE JURY_SCORE
    ADD CONSTRAINT CK_SCORE CHECK ( SCORE > 0 AND SCORE < 11 );

ALTER TABLE TEAMS
    ADD CHECK ( FINAL_POS > 0 AND FINAL_POS < 17 );