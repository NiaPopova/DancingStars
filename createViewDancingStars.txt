SET SCHEMA FN24_5MI0700203;

DROP VIEW
    PERFORMANCE_DETAILS;
DROP VIEW
    JURY_SCORES_SUMMARY;

CREATE VIEW PERFORMANCE_DETAILS AS
SELECT P.ID        AS PERFORMANCE_ID,
       T.PART_NAME AS PARTICIPANT_NAME,
       T.PART_PROF AS PARTICIPANT_PROFESSION,
       T.PROF_NAME AS PROFESSIONAL_NAME,
       D.NAME      AS DANCE_NAME,
       E.DATE      AS EPISODE_DATE,
       E.THEME     AS EPISODE_THEME,
       P.SCORE_AUD AS AUDIENCE_SCORE,
       P.NOTES,
       T.PHOTO,
       SUM(JS.SCORE) AS TOTAL_SCORE
FROM JURY_SCORE JS
JOIN JURY J ON JS.JURY_ID = J.ID
JOIN PERFORMANCES P ON JS.PERFORMANCE_ID = P.ID
JOIN TEAMS T ON P.TEAM_SMS = T.SMS
JOIN DANCES D ON P.DANCE_NAME = D.NAME
JOIN EPISODES E ON P.EP_DATE = E.DATE
GROUP BY P.ID, T.PART_NAME, T.PART_PROF, T.PROF_NAME, D.NAME, E.DATE, E.THEME, P.SCORE_AUD, P.NOTES, T.PHOTO;

SELECT * FROM PERFORMANCE_DETAILS;

CREATE VIEW JURY_SCORES_SUMMARY AS
SELECT P.ID              AS PERFORMANCE_ID,
       P.TEAM_SMS,
       AVG(JS.SCORE)     AS AVERAGE_JURY_SCORE,
       COUNT(JS.JURY_ID) AS JURY_COUNT
FROM PERFORMANCES P
         JOIN
     JURY_SCORE JS ON P.ID = JS.PERFORMANCE_ID
GROUP BY P.ID,
         P.TEAM_SMS;


SELECT *
FROM JURY_SCORES_SUMMARY;

